# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```bash
npm install
npm run start
```

или

```bash
yarn
yarn start
```

## Сборка

```bash
npm run build
```

или

```bash
yarn build
```

## Данные и типы данных, используемые в приложении

### Данные товара

```typescript
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: ProductCategory;
    price: number
}
```

### Тип данных, представляющий метод оплаты

```typescript
type PaymentMethod = 'online' | 'offline'
```

### Данные товара, используемые в отображении на странице

```typescript
type TProductBaseInfo = Pick<IProduct, 'title' | 'price' | 'category' | 'image'>;
```

### Данные товара, используемые в попапе товара

```typescript
type TProductInfo = Pick<IProduct, 'title' | 'price' | 'category' | 'description' | 'image'>;
```

### Данные товара, используемые в корзине

```typescript
type TProductBasketInfo = Pick<IProduct, 'title' | 'price' >;
```

### Данные покупателя

```typescript
interface IOrder {
    payment: PaymentMethod;
    address: string;
    email: string;
    telephone: string;
}
```

### Данные пользователя, используемые при оформлении заказа

```typescript
type TIOrderPaymentAndaddress = Pick<IOrder, 'payment' | 'address' >;
type TIOrderEmailAndPhone = Pick<IOrder, 'email' | 'phone' >;
```

### Тип, описывающий действия, доступные для карточки товара

```typescript
interface ICardActions {
    onClick: (event: MouseEvent) => void;
}
```


## Архитектура приложения

Архитектура приложения построена в соответствии с принципами MVP. Компоненты приложения разделены на следующие слои:

- слой данных, отвечает за хранение и модификацию данных
- слой представления, отвечает за визуализацию данных на странице
- презентер, обеспечивает взаимодействие между представлением и данными.

Слой представления инициирует события через брокер событий, которые вызывают методы слоя данных. Изменения данных в модели также генерируют события, которые активируют методы уровня представления. Основная логика приложения сосредоточена в слое презентера. 


### Базовые классы

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 


**Методы**:
 - `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
 - `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.



#### Класс ProductDataApi

Класс для работы с данными продуктов через API. Расширяет класс Api.
Логика работы: Выполняется GET-запрос к /product. Добавляется URL CDN ко всем путям изображений в данных о продуктах.

**Поля**:
- `cdn: string`: URL для обработки путей к изображениям продуктов.


**Методы**:
- `constructor(baseUrl: string, options: RequestInit = {}, cdn: string)`: Конструктор, принимающий базовый URL API, настройки запросов и URL CDN.
- `getProductListData(): Promise<{ total: number, items: IProduct[] }>`: Запрашивает список продуктов. Возвращает объект с полями:


#### Класс OrderDataApi

Класс для работы с заказами через API. Расширяет класс Api.
Логика работы: Выполняется POST-запрос к /order, передавая данные заказа.

**Методы**:
- `setOrder(data: IOrder): Promise<{ id: string, total: number }>`: Отправляет данные заказа на сервер.


#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

**Методы**:
 - `on` - подписка на событие
 - `emit` - инициализация события
 - `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
 - `onAll` - метод для подписки на все события
 - `offAll` - метод для сброса всех обработчиков

### Слой данных

#### Класс ProductData

Класс управляет данными товаров. Отвечает за их хранение и изменение.

Класс состоит из следующих полей и методов:

**Поля**:
- `_items: IProduct[]`: Список товаров, по умолчанию пустой.
- `_selected: IProduct | null`: Выбранный товар.

**Методы**:
- `set items(items: IProduct[])`: Сеттер для установки списка товаров. Принимает массив объектов `IProduct`. Устанавливает значение поля `_items` и генерирует событие `'model:products:loaded'`.
- `get items(): IProduct[]`: Геттер для получения списка товаров. Возвращает массив объектов `IProduct`.
- `getItem(id: string | null)`: Метод для получения товара по ID.
- `set selected(item: IProduct | null)`: Сеттер для установки выбранного товара. Принимает объект `IProduct` или `null`. Устанавливает значение поля `_selected` и генерирует событие `'model:product:selected'` с переданным объектом `item`.
- `get selected()`: Геттер для получения выбранного товара. Возвращает объект `IProduct` или `null`.

#### Класс OrderData

Класс управляет данными пользователя. Отвечает за их хранение и изменение.

Класс состоит из следующих полей и методов:

**Поля**:
- `_payment: PaymentMethod`: Метод оплаты.
- `_address: string`: Адрес доставки.
- `_email: string`: Электронная почта пользователя.
- `_phone: string`: Номер телефона пользователя.
- `_total: number`: Общая сумма заказа.
- `_items: string[]`: Массив с идентификаторами товаров в заказе.


**Методы**:
- `set orderItemsAndTotal(items: IProduct[])`: Сеттер для установки товаров в заказе и общей суммы заказа. Принимает массив объектов IProduct. Устанавливает значение полей _items и _total.
- `set userPaymentAndaddress(data: TIOrderPaymentAndaddress)`: Сеттер для установки данных о платеже и адресе пользователя. Принимает объект с данными типа TIOrderPaymentAndaddress. Устанавливает значение полей `_payment` и `_address`.
- `get userPaymentAndaddress()`: Геттер для получения данных о платеже и адресе.
- `set userEmailAndPhone(data: TIOrderEmailAndPhone)`: Сеттер для установки контактных данных пользователя. Принимает объект с данными типа TIOrderEmailAndPhone. Устанавливает значение полей `_email` и `_phone`.
- `get userEmailAndPhone()`: Геттер для получения контактных данных пользователя.
- `get orderInfo()`: Геттер для получения общей информации о заказе. Возвращает объект типа IOrder.
- `validateUserEmailAndPhone()`: метод валидации email и phone. Генерирует событие `'model:orderData:contactsForm:validationErrors'`, в котором передается объект типа { errors: string, status: boolean }
- `validateUserPaymentAndAddress()`: метод валидации payment и address. Генерирует событие `'model:orderData:orderForm:validationErrors'`, в котором передается объект типа { errors: string, status: boolean }

#### Класс BasketData

Класс управляет данными корзины покупок. Отвечает за хранение товаров, подсчёт общей суммы и количества товаров в корзине, а также за добавление, удаление и очистку корзины.

Класс состоит из следующих полей и методов:



**Поля**:
- `_items: IProduct[]`: Массив товаров в корзине.
- `_total: number`: Общая сумма корзины, вычисляется динамически на основе товаров в корзине.
- `_amount: number`: Количество товаров в корзине, вычисляется динамически на основе количества товаров в массиве.


**Методы**:
- `addProduct(product: IProduct)`: Метод для добавления товара в корзину. Принимает объект IProduct и добавляет его в массив `_items`. После добавления генерирует событие `'model:basket:changed'`.
- `removeProduct(id: string)`: Метод для удаления товара из корзины по ID. Принимает строку id товара и удаляет его из массива `_items`. После удаления генерирует событие `'model:basket:changed'`.
- `clearBasket()`: Метод для очистки всей корзины. Очищает массив `_items` и генерирует событие `'model:basket:changed'`.
- `get items()`: Геттер для получения списка всех товаров в корзине. Возвращает массив объектов IProduct.
- `get total()`: Геттер для получения общей суммы корзины. Рассчитывает сумму всех товаров в корзине, возвращает число.
- `get amount()`: Геттер для получения количества товаров в корзине. Возвращает число, равное количеству элементов в массиве `_items`.
- `isProductInBasket(product: IProduct): boolean`: Метод для проверки наличия товара в корзине. Принимает объект IProduct и возвращает true, если товар уже есть в корзине, иначе false.

### Слой отображения

#### Класс Component

Абстрактный класс для наследования другими классами. Содержит в себе базовую логику отображения - методы, которые могут быть использованы в дочерних классах.

Класс состоит из следующих полей и методов:
- `container: HTMLElement`: Контейнер разметки, в который будем размещен итоговый компонент отображения.
- `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает класс элемента.
- `setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое элемента.
- `setDisabled(element: HTMLElement, state: boolean)`: Устанавливает атрибут `disabled` для элемента.
- `setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает изображение для элемента.
- `render(data?: Partial<T>): HTMLElement`: Отрисовывает экземпляр класса.

#### Класс Card

Класс управляет отображением карточки товара. Отвечает за рендеринг и вывод информации о товаре, такой как название, цена и описание, в соответствующих элементах интерфейса. Является базовым классом, служит основой для создания дополнительный классов отображения карточек.

Класс состоит из следующих полей и методов:


**Поля**:
- `_title: HTMLElement`: Элемент DOM, представляющий название товара.
- `_price: HTMLElement`: Элемент DOM, представляющий цену товара.
- `_image?: HTMLImageElement`: (Необязательное) Элемент DOM для изображения товара.
- `_category?: HTMLElement`: (Необязательное) Элемент DOM для категории товара.
- `_button?: HTMLButtonElement`: (Необязательное) Элемент DOM для кнопки (например, добавления в корзину).
- `_description?: HTMLElement`: (Необязательное) Элемент DOM для описания товара.


**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Конструктор, который инициализирует экземпляр компонента, находит элементы интерфейса для отображения названия и цены товара.
- `title(value: string)`: Сеттер для установки названия. Принимает строку value и устанавливает ее в поле `_title`.
- `price(value: number | null)`: Сеттер для установки цены. Принимает число value или null и устанавливает его в поле `_price`. Если цена товара равна null, отображается текст 'Бесценно'. 
- `image(value: string)`: Сеттер для установки изображения. Принимает строку value и устанавливает ее в поле `_image`.
- `render(card: IProduct)`: Метод для рендеринга данных карточки товара. Возвращает элемент DOM, который содержит рендер компонента.

#### Класс CardBasketUI

Класс управляет отображением карточки товара в корзине. Этот класс расширяет Card, добавляя функциональность для удаления товара из корзины и изменения состояния кнопки в зависимости от того, находится ли товар в корзине.

**Поля**:
- `_index: HTMLElement`: Элемент DOM, представляющий индекс товара в корзине.

Класс состоит из следующих методов:
**Методы**:
- `constructor(container: HTMLElement, events: IEvents, actions?: ICardActions)`: Конструктор, который инициализирует экземпляр компонента, вызывает конструктор родительского класса Card, находит кнопку для удаления товара и добавляет обработчик события `onClick` для этой кнопки.
- `index(value: number)`: Сеттер для установки индекса товара в корзине. Принимает число value и устанавливает его в поле `_index`.

#### Класс CardCatalogUI

Класс управляет отображением карточки товара в каталоге. Этот класс расширяет Card, добавляя функциональность для отображения изображения, категории товара и обработки клика по карточке.

Класс состоит из следующих методов:
**Методы**:
- `constructor(container: HTMLElement, events: IEvents, actions?: ICardActions)`: Конструктор, который инициализирует экземпляр компонента, вызывает конструктор родительского класса Card, находит элементы для отображения изображения и категории товара и добавляет обработчик события `onClick` для клика по карточке.
- `category(value: string)`: Сеттер для установки категории товара. Принимает строку value и устанавливает ее в поле `_category`.



#### Класс CardPreviewUI

Класс управляет отображением карточки товара в режиме предварительного просмотра. Этот класс расширяет Card, добавляя функциональность для отображения изображения, категории, описания товара, а также обработки событий кнопки.

Класс состоит из следующих методов:

**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Конструктор, который инициализирует экземпляр компонента, вызывает конструктор родительского класса Card. Инициализирует элементы для изображения, категории, описания и кнопки. Добавляет обработчик события для кнопки, который генерирует событие `'ui:cardPreviewButton:clicked'` с текущим экземпляром карточки.
- `toggleStatus(value: boolean)`: Метод для изменения текста на кнопке в зависимости от состояния. Принимает булевое значение value. Если true, кнопка отображает текст 'Убрать из корзины'; если false, — 'Добавить'.
- `category(value: string)`: Сеттер для установки категории. Принимает строку value и устанавливает ее в поле `_category`.
- `description(value: string)`: Сеттер для установки описания. Принимает строку value и устанавливает ее в поле `_description`.

#### Класс FormUI

Класс управляет пользовательским интерфейсом формы. Отвечает за отображение ошибок, управление состоянием кнопки отправки и валидацией формы. Расширяет класс Component

Класс состоит из следующих полей и методов:

**Поля**:
 - `_submitButton: HTMLButtonElement` : Кнопка отправки формы.
- `_errors: HTMLElement`: Элемент для отображения сообщений об ошибках.


**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Конструктор, который инициализирует экземпляр компонента, вызывает конструктор родительского класса Component. Находит кнопку отправки и элемент для отображения ошибок.
- `toggleButton(state: boolean)`: Переключает активное состояние кнопки отправки. Принимает булевое значение state. Если true, кнопка становится активной; если false, — деактивируется.
- `set valid(value: boolean)`: Сеттер для управления состоянием кнопки отправки на основе валидности формы. Если value равно true, кнопка становится активной; если false, кнопка отключается.
- `set errors(value: string)`: Сеттер для отображения сообщения об ошибке. Устанавливает текст в элемент _errors.

#### Класс ContactsFormUI

Класс ContactsFormUI расширяет функциональность класса FormUI и предназначен для управления формой ввода контактных данных. Он включает обработку ввода, проверку валидности полей, отображение ошибок и управление состоянием кнопки отправки.

**Поля**:
 - `_emailInput: HTMLInputElement` : Поле ввода для email.
 - `_phoneInput: HTMLInputElement` : Поле ввода для телефона.


**Методы**
 - `constructor(container: HTMLElement, events: IEvents)` : Инициализирует элементы формы, добавляет обработчики событий для полей ввода и кнопки отправки.
 - `private onInput(): void` : Обработчик события ввода. Генерирует событие `'ui:contactsForm:update'` с данными формы.
 - `onSubmit(evt: Event): void` : Обработчик события отправки формы. Предотвращает стандартное поведение браузера. Генерирует событие с данными формы `'ui:contactsForm:submit'`.


#### Класс OrderFormUI

Класс OrderFormUI расширяет функциональность класса FormUI и управляет формой оформления заказа. Он обрабатывает выбор способа оплаты, ввод адреса, валидацию формы, отображение ошибок и отправку данных.

**Поля**:
- `_paymentButtonCard: HTMLButtonElement`: Кнопка выбора оплаты картой.
- `_paymentButtonCash: HTMLButtonElement`: Кнопка выбора оплаты наличными.
- `_addressInput: HTMLInputElement`: Поле для ввода адреса доставки.
- `_paymentType: string`: Выбранный способ оплаты ('online' или 'offline'), по умолчанию пустая строка.


**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Инициализирует элементы формы, добавляет обработчики событий для выбора способа оплаты, ввода адреса и отправки формы. 
- `onPaymentButtonClick(evt: Event, paymentType: string, clickedButton: HTMLButtonElement, otherButton: HTMLButtonElement)`: Обрабатывает выбор способа оплаты. Устанавливает или сбрасывает выбранный способ оплаты. Генерирует событие `'ui:orderForm:update'` с данными.
 - `private onInput(): void` : Обработчик события ввода. Генерирует событие `'ui:orderForm:update'` с данными формы.
- `onSubmit = (evt: Event)`: Обработчик отправки формы. Предотвращает стандартное поведение браузера. Генерирует событие `'ui:orderForm:submit'`.
- `switchButtons(activeButton: HTMLButtonElement, inactiveButton: HTMLButtonElement)`: Активирует выбранную кнопку способа оплаты, добавляя класс button_alt-active, и деактивирует другую кнопку.




#### Класс Page

Класс Page управляет основной структурой страницы, включая корзину, счетчик товаров, каталог и состояние блокировки интерфейса.

**Поля**:
- `_basketButton: HTMLButtonElement`: Кнопка открытия корзины.
- `_counter: HTMLElement`: Элемент для отображения количества товаров в корзине.
- `_catalog: HTMLElement`: Контейнер для отображения каталога товаров.
- `_wrapper: HTMLElement`: Обертка страницы, используемая для блокировки интерфейса.

**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Инициализирует основные элементы страницы. Добавляет обработчик на кнопку корзины, который вызывает событие `'ui:basket:opened'`.
- `set counter(value: number)`: Устанавливает текст элемента _counter для отображения количества товаров в корзине.
- `set catalog(items: HTMLElement[])`: Обновляет содержимое каталога, заменяя текущие элементы новыми.
- `set locked(value: boolean)`: Управляет состоянием блокировки страницы. Если значение true, добавляет класс page__wrapper_locked к обертке страницы, блокируя взаимодействие. Если false, удаляет этот класс.




#### Класс BasketUI

Класс управляет пользовательским интерфейсом корзины. Отвечает за отображение списка товаров, общей суммы и состояния кнопки подтверждения в корзине.

Класс состоит из следующих полей и методов:

**Поля**:
- `_list: HTMLElement`: Элемент DOM, представляющий список товаров в корзине.
- `_total: HTMLElement`: Элемент DOM, представляющий отображаемую сумму корзины.
- `_button: HTMLButtonElement`: Кнопка подтверждения корзины.

**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Конструктор, который инициализирует экземпляр компонента и находит необходимые элементы интерфейса. Создаёт обработчик события для кнопки подтверждения, которое генерирует событие `'ui:basket:confirmed'`.
- `set items(items: HTMLElement[])`: Сеттер для установки элементов списка корзины. Принимает массив элементов HTMLElement. Если массив не пустой, заменяет содержимое списка на переданные элементы. Если массив пуст, очищает список.
- `set total(total: number)`: Сеттер для установки общей суммы корзины. Принимает число, форматирует его с помощью функции formatNumber и отображает в соответствующем элементе DOM с добавлением текста ' синапсов'.
- `toggleButton(state: boolean)`: Метод для изменения состояния кнопки подтверждения. Принимает булевое значение state. Если значение true, кнопка активируется, если false — деактивируется.


#### Класс SuccessUI

Класс SuccessUI управляет отображением сообщения об успешном завершении заказа, включая описание суммы списания и кнопку закрытия сообщения.

**Поля**:
- `_sucessButton: HTMLButtonElement`: Кнопка для закрытия сообщения.
- `_description: HTMLSpanElement`: Элемент для отображения текста с информацией о списанной сумме.

**Методы**:
- `constructor(container: HTMLElement, events: IEvents)`: Инициализирует элементы интерфейса и добавляет обработчик на кнопку закрытия, который вызывает событие `'ui:successButton:pressed'`.
- `render(data: { value: number })`: Отображает текст с информацией о списанной сумме в элементе _description.




### Класс Modal

Класс для модального окна, расширяющий класс Component. Содержит поля для элементов, кнопки закрытия, а также создаёт слушатели нажатия кнопки закрытия модального окна. Конструктор вызывает родительский класс.

**Поля и методы класса:**
- `content(value: HTMLElement)`: Сеттер, устанавливающий элементы в контейнер контента. Принимает HTML-элемент.
- `open(): void`: Метод для открытия модального окна.
- `close(): void`: Метод для закрытия модального окна.
- `render(): HTMLElement`: Метод расширяет родительский, добавляя вызов метода открытия модального окна.




## Слой презентера

В данном проекте не выделен отдельный класс презентера. Весь функционал презентора реализован в файле `index.ts`, с помощью брокера событий и обработчиков событий.



**Список всех событий, которые могут генерироваться в системе:**\
**События изменения данных (генерируются классами моделями данных)**

- `model:products:loaded`: Загрузка списка товаров.
- `model:basket:changed`: Изменение данных корзины.
- `model:orderData:contactsForm:update`: Обновление данных контактов.
- `model:orderData:orderForm:update`: Обновление данных заказа.
- `model:orderData:contactsForm:validationErrors`: Валидация формы контактов.
- `model:orderData:orderForm:validationErrors`: Валидация формы заказа.

**События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)**

- `ui:cardCatalog:clicked`: Нажатие на карточку товара в каталоге.
- `ui:cardPreviewButton:clicked`: Нажатие на кнопку добавления товара в корзину.
- `ui:basket:opened`: Открытие корзины.
- `ui:cardDeleteButton:clicked`: Удаление товара из корзины.
- `ui:basket:confirmed`: Подтверждение корзины.
- `ui:orderForm:submit`: Отправка формы заказа.
- `ui:contactsForm:submit`: Отправка формы контактов.
- `ui:sucсessButton:pressed`: Нажатие на кнопку закрытия сообщения об успешном заказе.
- `modal:open`: Открытие модального окна.
- `modal:close`: Закрытие модального окна.


*Пример взаимодействия слоя данных со слоем представления:*

Пользователь нажимает на кнопку "Добавить" в карточке товара:
Это действие вызывает  событие `model:basket:changed`:
Обработчик этого события обновляет представление корзины:
Обновляет счетчик товаров на странице (page.counter).
Создает и рендерит карточки товаров в корзине (cardsInBasket).
Обновляет общую сумму корзины (basketComponent.total).

